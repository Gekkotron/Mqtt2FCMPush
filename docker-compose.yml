version: '3.8'

services:
  mqtt2fcm:
    build: .
    container_name: mqtt2fcm-push
    restart: unless-stopped
    dns:
      - 8.8.8.8
      - 8.8.4.4
      - 1.1.1.1
    environment:
      # MQTT Configuration
      - MQTT_BROKER=${MQTT_BROKER:-localhost}
      - MQTT_PORT=${MQTT_PORT:-1883}
      - MQTT_TOPIC=${MQTT_TOPIC:-notification/#}
      - MQTT_USERNAME=${MQTT_USERNAME:-}
      - MQTT_PASSWORD=${MQTT_PASSWORD:-}
      
      # Firebase Configuration
      - FIREBASE_CREDENTIALS=${FIREBASE_CREDENTIALS:-credential.json}
      
      # Firestore Configuration
      - USE_FIRESTORE=${USE_FIRESTORE:-True}
      - FIRESTORE_COLLECTION=${FIRESTORE_COLLECTION:-notification}
      - ADMIN_ONLY=${ADMIN_ONLY:-True}
      
      # Notification Configuration
      - DEFAULT_PRIORITY=${DEFAULT_PRIORITY:-high}
      - DEFAULT_TTL=${DEFAULT_TTL:-43200}
      
      # Retry Configuration
      - RETRY_INTERVAL=${RETRY_INTERVAL:-60}
      - MAX_RETRIES=${MAX_RETRIES:-10}
      
      # Heartbeat Configuration
      - HEARTBEAT_ENABLED=${HEARTBEAT_ENABLED:-True}
      - HEARTBEAT_INTERVAL=${HEARTBEAT_INTERVAL:-60}
      - HEARTBEAT_TOPIC=${HEARTBEAT_TOPIC:-notification/heartbeat}
    
    volumes:
      # Mount credential file if you prefer to keep it outside the image
      - ./credential.json:/app/credential.json:ro
      # Persist notification queue across restarts
      - ./notification_queue.json:/app/notification_queue.json
    
    networks:
      - home-automation_homeautomation

networks:
  home-automation_homeautomation:
    external: true
